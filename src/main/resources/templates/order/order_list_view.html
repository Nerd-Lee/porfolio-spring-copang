<!--
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>주문 내역</title>
</head>
<body>
<div class="container">
    <h2>나의 주문 내역</h2>
	<hr>
	<form action="/orders" method="get">
		<select name="sortOrder" th:value="${orderSearchDto.sortOrder}">
			<option value="desc" th:selected="${orderSearchDto.sortOrder == 'desc'}">최신순</option>
			<option value="asc" th:selected="${orderSearchDto.sortOrder == 'asc'}">오래된순</option>
		</select>
		
	    <select name="orderStatus" th:value="${orderSearchDto.orderStatus}">
	        <option value="">전체 상태</option>
	        <option value="ORDER">주문 완료</option>
	        <option value="CANCEL">주문 취소</option>
	    </select>

	    <input type="date" name="startDate" th:value="${orderSearchDto.startDate}">
	    ~
	    <input type="date" name="endDate" th:value="${orderSearchDto.endDate}">

	    <input type="text" name="itemName" th:value="${orderSearchDto.itemName}" placeholder="상품명 입력">

	    <button type="submit">조회</button>
	</form>
    <table border="1">
        <thead>
        <tr>
            <th>주문번호</th>
            <th>주문 상품</th>
            <th>주문 시간</th>
            <th>주문 상태</th>
            <th>작업</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${#lists.isEmpty(orders)}">
            <td colspan="5">주문 내역이 없습니다.</td>
        </tr>

        <tr th:each="order : ${orders}">
            <td th:text="${order.id}">1</td>
            <td>
                <div th:each="orderItem : ${order.orderItems}">
                    <span th:text="${orderItem.item.name}">상품명</span> / 
                    <span th:text="${orderItem.count} + '개'">수량</span>
                </div>
            </td>
            <td th:text="${#temporals.format(order.orderDateTime, 'yyyy-MM-dd HH:mm')}">2023-10-27</td>
			<td>
				<a th:href="@{/orders/{id}(id=${order.id})}">상세보기</a>
			</td>
            <td th:text="${order.status}">ORDER</td>
            <td>
                <form th:if="${order.status.name() == 'ORDER'}" 
                      th:action="@{/orders/{id}/cancel(id=${order.id})}" method="post">
                    <button type="submit" onclick="return confirm('정말 취소하시겠습니까?')">주문취소</button>
                </form>
				<a th:if="${order.status.name() == 'COMPLETED'}" 
		           th:href="@{/review/write(orderId=${order.id})}" class="btn btn-primary">
		            리뷰 작성
		        </a>
                <span th:if="${order.status.name() == 'CANCEL'}">취소완료</span>
				<span th:if="${order.status.name() == 'REVIEW_COMPLETED'}">리뷰작성 완료</span>
            </td>
			<td>
		        <form th:if="${order.status.name() == 'ORDER'}" 
		              th:action="@{/order/{id}/complete(id=${order.id})}" method="post">
		            <button type="submit" onclick="return confirm('물건을 잘 받으셨나요? 구매확정 후 리뷰 작성이 가능합니다.')">
		                수취확인
		            </button>
		        </form>
		    </td>
        </tr>
        </tbody>
    </table>

    <div style="margin-top: 20px;">
        <button th:onclick="|location.href='@{/}'|">홈으로 이동</button>
    </div>
</div>
</body>
</html>
-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>주문 내역 - KOPANG</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f4f5f7; font-family: 'Pretendard', sans-serif; color: #333; }
        .container { max-width: 900px; margin-top: 40px; margin-bottom: 80px; }
        
        .page-title { font-weight: 800; font-size: 26px; margin-bottom: 30px; }

        /* 검색 필터 바 */
        .search-bar { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 30px; border: 1px solid #eee; }
        .form-select, .form-control { border-radius: 6px; font-size: 14px; }
        .btn-search { background: #0073e6; color: #fff; font-weight: 600; padding: 0 25px; border-radius: 6px; }

        /* 주문 카드 스타일 */
        .order-card { background: #fff; border-radius: 12px; border: 1px solid #eee; margin-bottom: 20px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
        .order-card-header { background: #fafafa; padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .order-date { font-weight: 700; font-size: 16px; }
        .order-id { color: #888; font-size: 13px; }
        
        .order-card-body { padding: 20px; }
        .order-item { display: flex; align-items: center; margin-bottom: 15px; }
        .order-item:last-child { margin-bottom: 0; }
        .item-info { flex-grow: 1; margin-left: 15px; }
        .item-name { font-weight: 600; font-size: 15px; color: #333; text-decoration: none; }
        .item-meta { font-size: 13px; color: #777; margin-top: 3px; }

        /* 주문 상태 라벨 */
        .status-badge { padding: 5px 12px; border-radius: 50px; font-size: 12px; font-weight: 700; }
        .status-order { background: #e7f3ff; color: #0073e6; }
        .status-cancel { background: #fff0f0; color: #e03131; }
        .status-complete { background: #ebfbee; color: #099268; }

        /* 버튼 그룹 */
        .btn-group-custom { display: flex; gap: 8px; margin-top: 15px; border-top: 1px solid #f1f1f1; padding-top: 15px; }
        .btn-action { font-size: 13px; font-weight: 600; padding: 8px 16px; border-radius: 6px; text-decoration: none; transition: 0.2s; flex: 1; text-align: center; }
        .btn-outline { border: 1px solid #ddd; color: #555; background: #fff; }
        .btn-outline:hover { background: #f8f9fa; border-color: #ccc; }
        .btn-primary-custom { background: #0073e6; color: #fff; border: none; }
        .btn-primary-custom:hover { background: #005bb5; }

        .empty-state { padding: 80px 0; text-align: center; color: #999; }
    </style>
</head>
<body>

<div class="container">
    <h2 class="page-title"><i class="fas fa-shopping-bag me-2"></i>나의 주문 내역</h2>

    <div class="search-bar">
        <form action="/orders" method="get" class="row g-2">
            <div class="col-md-2">
                <select name="sortOrder" class="form-select">
                    <option value="desc" th:selected="${orderSearchDto.sortOrder == 'desc'}">최신순</option>
                    <option value="asc" th:selected="${orderSearchDto.sortOrder == 'asc'}">오래된순</option>
                </select>
            </div>
            <div class="col-md-2">
                <select name="orderStatus" class="form-select">
                    <option value="">전체 상태</option>
                    <option value="ORDER" th:selected="${orderSearchDto.orderStatus == 'ORDER'}">주문 완료</option>
                    <option value="CANCEL" th:selected="${orderSearchDto.orderStatus == 'CANCEL'}">주문 취소</option>
					<option value="CANCEL" th:selected="${orderSearchDto.orderStatus == 'COMPLETED'}">배송 완료</option>
					<option value="CANCEL" th:selected="${orderSearchDto.orderStatus == 'REVIEW_COMPLETED'}">리뷰 작성 완료</option>
                </select>
            </div>
            <div class="col-md-4">
                <div class="input-group">
                    <input type="date" name="startDate" th:value="${orderSearchDto.startDate}" class="form-control">
                    <span class="input-group-text">~</span>
                    <input type="date" name="endDate" th:value="${orderSearchDto.endDate}" class="form-control">
                </div>
            </div>
            <div class="col-md-3">
                <input type="text" name="itemName" th:value="${orderSearchDto.itemName}" class="form-control" placeholder="상품명 입력">
            </div>
            <div class="col-md-1">
                <button type="submit" class="btn btn-search w-100 h-100"><i class="fas fa-search"></i></button>
            </div>
        </form>
    </div>

    <div th:if="${#lists.isEmpty(orders)}" class="empty-state">
        <i class="fas fa-receipt fa-4x mb-3"></i>
        <p class="fs-5">주문 내역이 없습니다.</p>
        <a href="/" class="btn btn-primary mt-2">쇼핑하러 가기</a>
    </div>

    <div th:each="order : ${orders}" class="order-card">
        <div class="order-card-header">
            <div>
                <span class="order-date" th:text="${#temporals.format(order.orderDateTime, 'yyyy.MM.dd')}">2023.10.27</span>
                <span class="order-id ms-2" th:text="'(주문번호: ' + ${order.id} + ')'">#12345</span>
            </div>
            <div class="d-flex align-items-center">
                <span th:if="${order.status.name() == 'ORDER'}" class="status-badge status-order">주문접수</span>
                <span th:if="${order.status.name() == 'CANCEL'}" class="status-badge status-cancel">주문취소</span>
                <span th:if="${order.status.name() == 'COMPLETED'}" class="status-badge status-complete">배송완료</span>
                <span th:if="${order.status.name() == 'REVIEW_COMPLETED'}" class="status-badge status-complete">리뷰 작성 완료</span>
                
                <a th:href="@{/orders/{id}(id=${order.id})}" class="ms-3 text-muted small text-decoration-none">상세보기 <i class="fas fa-chevron-right"></i></a>
            </div>
        </div>

        <div class="order-card-body">
            <div th:each="orderItem : ${order.orderItems}" class="order-item">
                <img th:src="${orderItem.item.imageUrl}" style="width:60px; height:60px; object-fit:cover; border-radius:6px; border:1px solid #eee;">
                
                <div class="item-info">
                    <a href="#" class="item-name" th:text="${orderItem.item.name}">상품명</a>
                    <div class="item-meta">
                        <span th:text="${#numbers.formatInteger(orderItem.item.price, 0, 'COMMA')} + '원'"></span>
                        <span class="mx-1">|</span>
                        <span th:text="${orderItem.count} + '개'">1개</span>
                    </div>
                </div>
            </div>

            <div class="btn-group-custom">
                <form th:if="${order.status.name() == 'ORDER'}" 
                      th:action="@{/orders/{id}/cancel(id=${order.id})}" method="post" class="flex-fill">
                    <button type="submit" class="btn-action btn-outline w-100" onclick="return confirm('정말 취소하시겠습니까?')">주문취소</button>
                </form>

                <form th:if="${order.status.name() == 'ORDER'}" 
                      th:action="@{/order/{id}/complete(id=${order.id})}" method="post" class="flex-fill">
                    <button type="submit" class="btn-action btn-primary-custom w-100" onclick="return confirm('물건을 잘 받으셨나요?\n구매확정 후 리뷰 작성이 가능합니다.')">
                        수취확인
                    </button>
                </form>

                <a th:if="${order.status.name() == 'COMPLETED'}" 
                   th:href="@{/review/write(orderId=${order.id})}" class="btn-action btn-primary-custom flex-fill">
                    리뷰 작성하기
                </a>
                
                <div th:if="${order.status.name() == 'CANCEL'}" class="text-muted small text-center w-100 py-2">
                    취소가 완료된 주문입니다.
                </div>
                <div th:if="${order.status.name() == 'REVIEW_COMPLETED'}" class="text-success small text-center w-100 py-2">
                    감사합니다! 리뷰 작성이 완료되었습니다.
                </div>
            </div>
        </div>
    </div>

    <div class="text-center mt-5">
        <a href="/" class="btn btn-outline-secondary px-4 py-2" style="border-radius: 8px; font-weight: 600;">
            <i class="fas fa-home me-2"></i>홈으로 이동
        </a>
    </div>
</div>

</body>
</html>