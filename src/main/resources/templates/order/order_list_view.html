<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>주문 내역</title>
</head>
<body>
<div class="container">
    <h2>나의 주문 내역</h2>
	<hr>
	<form action="/orders" method="get">
		<select name="sortOrder" th:value="${orderSearchDto.sortOrder}">
			<option value="desc" th:selected="${orderSearchDto.sortOrder == 'desc'}">최신순</option>
			<option value="asc" th:selected="${orderSearchDto.sortOrder == 'asc'}">오래된순</option>
		</select>
		
	    <select name="orderStatus" th:value="${orderSearchDto.orderStatus}">
	        <option value="">전체 상태</option>
	        <option value="ORDER">주문 완료</option>
	        <option value="CANCEL">주문 취소</option>
	    </select>

	    <input type="date" name="startDate" th:value="${orderSearchDto.startDate}">
	    ~
	    <input type="date" name="endDate" th:value="${orderSearchDto.endDate}">

	    <input type="text" name="itemName" th:value="${orderSearchDto.itemName}" placeholder="상품명 입력">

	    <button type="submit">조회</button>
	</form>
    <table border="1">
        <thead>
        <tr>
            <th>주문번호</th>
            <th>주문 상품</th>
            <th>주문 시간</th>
            <th>주문 상태</th>
            <th>작업</th>
        </tr>
        </thead>
        <tbody>
        <tr th:if="${#lists.isEmpty(orders)}">
            <td colspan="5">주문 내역이 없습니다.</td>
        </tr>

        <tr th:each="order : ${orders}">
            <td th:text="${order.id}">1</td>
            <td>
                <div th:each="orderItem : ${order.orderItems}">
                    <span th:text="${orderItem.item.name}">상품명</span> / 
                    <span th:text="${orderItem.count} + '개'">수량</span>
                </div>
            </td>
            <td th:text="${#temporals.format(order.orderDateTime, 'yyyy-MM-dd HH:mm')}">2023-10-27</td>
			<td>
				<a th:href="@{/orders/{id}(id=${order.id})}">상세보기</a>
			</td>
            <td th:text="${order.status}">ORDER</td>
            <td>
                <form th:if="${order.status.name() == 'ORDER'}" 
                      th:action="@{/orders/{id}/cancel(id=${order.id})}" method="post">
                    <button type="submit" onclick="return confirm('정말 취소하시겠습니까?')">주문취소</button>
                </form>
				<a th:if="${order.status.name() == 'COMPLETED'}" 
		           th:href="@{/review/write(orderId=${order.id})}" class="btn btn-primary">
		            리뷰 작성
		        </a>
                <span th:if="${order.status.name() == 'CANCEL'}">취소완료</span>
				<span th:if="${order.status.name() == 'REVIEW_COMPLETED'}">리뷰작성 완료</span>
            </td>
			<td>
		        <form th:if="${order.status.name() == 'ORDER'}" 
		              th:action="@{/order/{id}/complete(id=${order.id})}" method="post">
		            <button type="submit" onclick="return confirm('물건을 잘 받으셨나요? 구매확정 후 리뷰 작성이 가능합니다.')">
		                수취확인
		            </button>
		        </form>
		    </td>
        </tr>
        </tbody>
    </table>

    <div style="margin-top: 20px;">
        <button th:onclick="|location.href='@{/}'|">홈으로 이동</button>
    </div>
</div>
</body>
</html>