<!--
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>주문서 작성</title>
	<script src="/js/common.js"></script>
	<script th:inline="javascript">
	    // 타임리프 변수를 안전하게 자바스크립트 인자로 전달
	    checkErrorMessage([[${errorMessage}]]);
	</script>
</head>
<body>
<div class="container">
    <h2>주문 / 결제</h2>
    
    <form th:action="@{/order/form/process}" th:object="${orderForm}" method="post">
		<fieldset>
		    <legend>주문 상품 정보</legend>
		    <table border="1" style="width: 100%">
		        <tr>
					<th>상품이미지</th>
		            <th>상품명</th>
		            <th>수량</th>
		            <th>가격</th>
		            <th>합계</th>
		        </tr>
		        <tr th:each="item, stat : ${orderForm.orderItems}">
		            <input type="hidden" th:name="|orderItems[${stat.index}].itemId|" th:value="${item.itemId}">
		            <input type="hidden" th:name="|orderItems[${stat.index}].count|" th:value="${item.count}">
		            
					<td>
						<img th:src="${item.imageUrl}" style="width:50px;">
					</td>
		            <td th:text="${item.itemName}"></td>
		            <td th:text="${item.count} + '개'"></td>
		            <td th:text="${item.itemPrice} + '원'"></td>
		            <td th:text="${item.itemPrice * item.count} + '원'"></td>
		        </tr>
		    </table>
		    <hr>
		    <h3>최종 결제 금액: <span th:text="${orderForm.totalPrice}"></span>원</h3>
		</fieldset>

        <br>

        <fieldset>
            <legend>배송지 정보</legend>
            <div>
                <label>받는 사람</label>
                <input type="text" th:field="*{receiverName}" required>
            </div>
            <div>
                <label>배송 주소</label>
                <input type="text" th:field="*{address}" placeholder="주소를 입력하세요" required>
            </div>
            <div>
                <label>연락처</label>
                <input type="text" th:field="*{phoneNumber}" placeholder="010-0000-0000" required>
            </div>
        </fieldset>

        <div style="margin-top: 20px;">
            <button type="submit">결제하기 (주문 완료)</button>
            <button type="button" onclick="history.back()">취소</button>
        </div>
    </form>
</div>
</body>
</html>
-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>주문/결제 - KOPANG</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="/js/common.js"></script>
    <script th:inline="javascript">
        checkErrorMessage([[${errorMessage}]]);
    </script>
    <style>
        body { background-color: #f4f5f7; font-family: 'Pretendard', sans-serif; color: #333; }
        .container { max-width: 1100px; margin-top: 40px; margin-bottom: 80px; }
        
        .page-title { font-weight: 800; font-size: 28px; margin-bottom: 30px; }
        
        /* 섹션 카드 스타일 */
        .order-section { background: #fff; border-radius: 12px; padding: 30px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #eee; }
        .section-title { font-size: 18px; font-weight: 700; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; }

        /* 상품 테이블 */
        .item-table th { background-color: #fafafa; font-size: 14px; color: #666; font-weight: 600; text-align: center; }
        .item-img { width: 60px; height: 60px; object-fit: cover; border-radius: 6px; border: 1px solid #eee; }
        
        /* 배송지 폼 (상단 레이블 균형) */
        .form-group { margin-bottom: 18px; }
        .form-label { display: block; font-weight: 600; color: #444; font-size: 14px; margin-bottom: 8px; }
        .form-control { padding: 12px; border-radius: 8px; border: 1px solid #ddd; }
        .form-control:focus { border-color: #0073e6; box-shadow: 0 0 0 3px rgba(0, 115, 230, 0.1); }

        /* 우측 결제 요약 박스 */
        .payment-summary { position: sticky; top: 100px; background: #fff; border: 2px solid #0073e6; border-radius: 12px; padding: 25px; }
        .price-row { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 16px; }
        .total-price { font-size: 24px; font-weight: 900; color: #ae0000; }
        
        /* 버튼 스타일 */
        .btn-order { background: #0073e6; border: none; color: #fff; padding: 16px; font-weight: 800; font-size: 18px; border-radius: 8px; transition: 0.2s; }
        .btn-order:hover { background: #005bb5; transform: translateY(-2px); }
        .btn-cancel { background: #f8f9fa; border: 1px solid #ddd; color: #666; padding: 12px; border-radius: 8px; font-weight: 600; text-decoration: none; display: block; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2 class="page-title text-center mb-5">주문 / 결제</h2>
    
    <form th:action="@{/order/form/process}" th:object="${orderForm}" method="post">
        <div class="row g-4">
            
            <div class="col-lg-8">
                
                <div class="order-section">
                    <div class="section-title"><i class="fas fa-box me-2"></i>주문 상품 정보</div>
                    <div class="table-responsive">
                        <table class="table align-middle item-table">
                            <thead>
                                <tr>
                                    <th style="width: 80px;">이미지</th>
                                    <th>상품명</th>
                                    <th>수량</th>
                                    <th class="text-end">합계</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item, stat : ${orderForm.orderItems}">
                                    <input type="hidden" th:name="|orderItems[${stat.index}].itemId|" th:value="${item.itemId}">
                                    <input type="hidden" th:name="|orderItems[${stat.index}].count|" th:value="${item.count}">
                                    
                                    <td class="text-center">
                                        <img th:src="${item.imageUrl}" class="item-img" alt="상품이미지">
                                    </td>
                                    <td>
                                        <div class="fw-bold" th:text="${item.itemName}">상품명</div>
                                        <div class="text-muted small" th:text="${#numbers.formatInteger(item.itemPrice, 0, 'COMMA')} + '원'"></div>
                                    </td>
                                    <td class="text-center" th:text="${item.count} + '개'"></td>
                                    <td class="text-end fw-bold" th:text="${#numbers.formatInteger(item.itemPrice * item.count, 0, 'COMMA')} + '원'"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="order-section">
                    <div class="section-title"><i class="fas fa-map-marker-alt me-2"></i>배송지 정보</div>
                    
                    <div class="form-group">
                        <label for="receiverName" class="form-label">받는 사람</label>
                        <input type="text" id="receiverName" th:field="*{receiverName}" class="form-control" placeholder="이름을 입력하세요" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="address" class="form-label">배송 주소</label>
                        <input type="text" id="address" th:field="*{address}" class="form-control" placeholder="전체 주소를 입력하세요" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="phoneNumber" class="form-label">연락처</label>
                        <input type="text" id="phoneNumber" th:field="*{phoneNumber}" class="form-control" placeholder="010-0000-0000" required>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="payment-summary">
                    <div class="section-title border-primary">최종 결제 금액</div>
                    
                    <div class="price-row">
                        <span>총 상품 금액</span>
                        <span th:text="${#numbers.formatInteger(orderForm.totalPrice, 0, 'COMMA')} + '원'"></span>
                    </div>
                    <div class="price-row">
                        <span>배송비</span>
                        <span class="text-success fw-bold">무료</span>
                    </div>
                    
                    <hr>
                    
                    <div class="price-row align-items-center">
                        <span class="fw-bold">합계</span>
                        <span class="total-price" th:text="${#numbers.formatInteger(orderForm.totalPrice, 0, 'COMMA')} + '원'"></span>
                    </div>

                    <div class="mt-4">
                        <button type="submit" class="btn-order w-100 mb-2">결제하기</button>
                        <button type="button" class="btn-cancel w-100" onclick="history.back()">취소</button>
                    </div>
                </div>
            </div>

        </div>
    </form>
</div>

</body>
</html>