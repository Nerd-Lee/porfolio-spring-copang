<html xmlns:th="http://www.thymeleaf.org">
<head>
    <script src="/js/common.js"></script>
	<script src="/js/cart_list_view.js"></script>
    <script th:inline="javascript">
        checkErrorMessage([[${errorMessage}]]);
    </script>
</head>
<div class="container">
    <h2>내 장바구니</h2>
    
    <form th:action="@{/cart/order/form}" method="post" onsubmit="return validateOrder()">
        <table border="1">
            <thead>
                <tr>
                    <th><input type="checkbox" id="checkAllBox" onclick="checkAll()"> 전체</th>
                    <th>상품이미지</th>
                    <th>상품명</th>
                    <th>가격</th>
                    <th>수량</th>
                    <th>합계</th>
                    <th>변경</th>
                    <th>비우기</th>
                </tr>
            </thead>
            <tbody>
                <tr th:if="${#lists.isEmpty(cartItems)}">
                    <td colspan="8">장바구니가 비어 있습니다.</td>
                </tr>
                
                <tr th:each="cartItem : ${cartItems}">
                    <td>
                        <input type="checkbox" name="cartItemIds" th:value="${cartItem.id}" onchange="updateOrderSum()">
                    </td>
                    <td>
                        <img th:src="${cartItem.item.imageUrl}" style="width:50px;">
                    </td>
                    <td th:text="${cartItem.item.name}">상품명</td>
                    <td th:text="${cartItem.item.price} + '원'">가격</td>
                    <td th:text="${cartItem.count} + '개'">수량</td>
					<td class="unitPrice" th:data-price="${cartItem.item.price * cartItem.count}" 
				        th:text="${cartItem.item.price * cartItem.count} + '원'">
				    </td>
					<td>
						<form th:action="@{/cart/item/{id}/update(id=${cartItem.id})}" method="post" style="display: inline;">
					        <input type="number" name="count" th:value="${cartItem.count}" min="0" style="width: 50px;">
				            <button type="submit">변경</button>
				        </form>
				    </td>
					<td>
						<form th:action="@{/cart/item/{id}/delete(id=${cartItem.id})}" method="post">
				 	    	<button type="submit" onclick="return confirm('장바구니에서 삭제하시겠습니까?')">X</button>
				        </form>
				    </td>
                </tr>
            </tbody>
        </table>

        <div style="margin-top: 20px;">
            <h3>총 결제 예정 금액: <span id="finalTotalPrice">0원</span></h3>
        </div>

        <div style="margin-top: 20px;">
            <button type="button" th:onclick="|location.href='@{/}'|">쇼핑 계속하기</button>
			<button type="submit" th:if="${!#lists.isEmpty(cartItems)}">선택 상품 주문하기</button>
			<button type="submit" th:formaction="@{/cart/items/delete}" onclick="return confirm('선택한 상품을 장바구니에서 삭제하시겠습니까?')"
		            style="background-color: #ff4d4d; color: white;">
		        	선택 상품 삭제
		    </button>
        </div>
    </form>
</div>
</html>