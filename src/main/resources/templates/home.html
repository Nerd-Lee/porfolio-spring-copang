<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
	<style>
        body { background-color: #f4f5f7; font-family: 'Pretendard', sans-serif; font-size:14px;}
        
		.header { padding: 10px 0; background: #fff; border-bottom: 1px solid #ddd;}
		
		/* 1. í—¤ë” ë‚´ë¶€ ì»¨í…Œì´ë„ˆ êµ¬ì¡° ë³€ê²½ */
		.header .container {
		    display: flex;
		    flex-direction: column; /* ì„¸ë¡œë¡œ ì¸µì„ ìŒ“ìŒ */
		    align-items: stretch;
		}

		/* 2. ë¡œê³ ì™€ ë©”ë‰´ê°€ ë“¤ì–´ê°ˆ ì²« ë²ˆì§¸ ì¤„ */
		.header-top {
		    display: flex;
		    justify-content: space-between; /* ì–‘ ë ì •ë ¬ */
		    align-items: center;
		    width: 100%;
		}

		/* 3. ê²€ìƒ‰ì°½ì´ ë“¤ì–´ê°ˆ ë‘ ë²ˆì§¸ ì¤„ */
		.header-bottom {
		    display: flex;
		    justify-content: center; /* ê²€ìƒ‰ì°½ ì¤‘ì•™ ì •ë ¬ */
		    width: 100%;
		    margin-top: 15px; /* ë¡œê³ ì¤„ê³¼ì˜ ê°„ê²© */
		}

		/* ê²€ìƒ‰ì°½ ë„ˆë¹„ ê³ ì • í•´ì œ ë° ìµœì í™” */
		.search-wrapper {
		    width: 100%;
		    max-width: 600px; /* ë„ˆë¬´ í¼ì§€ì§€ ì•Šê²Œ ìµœëŒ€ì¹˜ ì œí•œ */
		    margin: 0; 
		    position: relative;
		}
        
        /* ë¡œê³  ìŠ¤íƒ€ì¼ */
        .logo { font-size: 26px; font-weight: 800; color: #0073e6; text-decoration: none; letter-spacing: -1px; min-width: 120px; }
        
        /* ê²€ìƒ‰ì°½ ì˜ì—­ */
        .search-wrapper { flex-grow: 1; max-width: 100%; margin: 0 20px; position: relative; }
        .search-bar { border: 2px solid #0073e6; border-radius: 4px; display: flex; overflow: hidden; background: #fff; }
        .search-bar input { border: none; padding: 10px 15px; flex-grow: 1; outline: none; width: 100%; }
        .search-bar .btn-search { background: #0073e6; color: #fff; border: none; padding: 0 20px; cursor: pointer; }
        
        /* ìƒì„¸ í•„í„° */
        #filter-section { 
            display: none; background: #fff; border: 1px solid #ddd; border-top: none;
            padding: 15px; position: absolute; width: 100%; top: 100%; left: 0; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-radius: 0 0 8px 8px; z-index: 999;
        }
        .filter-toggle-btn { background: none; border: none; color: #666; font-size: 13px; margin-top: 5px; cursor: pointer; text-align: left; padding: 0; }

        /* ë©”ë‰´ ê·¸ë£¹ */
        .nav-menu-group { display: flex; align-items: center; gap: 15px; }

        /* ê°œë³„ ë©”ë‰´ ë§í¬ */
        .nav-link {
            color: #333; font-size: 12px; text-decoration: none;
            display: flex; flex-direction: column; align-items: center;
            gap: 2px; min-width: 50px; white-space: nowrap;
        }
        .nav-link i { font-size: 18px; margin-bottom: 2px; }
        .nav-link:hover, .nav-link:hover i { color: #0073e6; }

        /* ìƒí’ˆ ê·¸ë¦¬ë“œ */
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; margin-top: 20px; padding: 0 10px; }
        .product-card { background: #fff; border-radius: 4px; border: 1px solid #eee; overflow: hidden; text-decoration: none; color: inherit; transition: 0.2s; }
        .product-card:hover { border-color: #0073e6; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .product-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; }
        .product-info { padding: 12px; }

        /* ğŸ“± ë°˜ì‘í˜• í•µì‹¬ ë¯¸ë””ì–´ ì¿¼ë¦¬ */
        @media (max-width: 991px) {
            .header-container { flex-wrap: wrap !important; }
            .logo { order: 1; }
            .nav-menu-group { order: 2; }
            .search-wrapper { order: 3; flex-basis: 100%; margin: 15px 0 5px 0; max-width: none; }
        }
		
        @media (max-width: 576px) {
			.logo { font-size: 18px !important; letter-spacing: -1.5px; min-width: auto; }
			.header-top { padding: 0 5px; }
			
			.nav-link {
		        padding: 0 2px !important;
		        min-width: 35px !important; /* í„°ì¹˜ ê°€ëŠ¥í•œ ìµœì†Œ ë²”ìœ„ ìœ ì§€ */
		    }
			.nav-menu-group form {
		        display: inline-flex !important;
		        margin: 0 !important;
		    }
			.nav-link span { display: none; } /* ì¢ì€ í™”ë©´ì—ì„œ í…ìŠ¤íŠ¸ ìˆ¨ê¹€ */
            .nav-link i { font-size: 15px; }
            .nav-menu-group { 	
				gap: 2px !important; /* ì•„ì´ì½˜ ì‚¬ì´ ê°„ê²© ìµœì†Œí™” */
		        flex-shrink: 1;      /* ê³µê°„ ëª¨ìë¼ë©´ ì¤„ì–´ë“¤ê²Œ í—ˆìš© */
		        justify-content: flex-end; 
			}
			
			.header-bottom { margin-top: 10px; }
			.search-wrapper{ padding: 0 5px; }
           
			 .product-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; } /* ëª¨ë°”ì¼ì€ ë¬´ì¡°ê±´ í•œ ì¤„ì— 2ê°œ */ 
		     .product-info { padding: 8px; }
		     .product-name { font-size: 13px; line-height: 1.4; height: 2.8em; overflow: hidden; }
		     .product-price { font-size: 15px; font-weight: bold; margin-top: 4px; }
        }
    </style>
</head>
<body>
<header class="header">
    <div class="container">
        <div class="header-top">
            <a href="/" class="logo">KOPANG</a>
            
            <div class="nav-menu-group">
                <th:block th:if="${session.loginMember != null}">
                    <a class="nav-link" href="/items/list/my"><i class="fas fa-tasks"></i><span>ë‚´ìƒí’ˆê´€ë¦¬</span></a>
                    <a class="nav-link" href="/item/add"><i class="fas fa-plus-circle"></i><span>ìƒí’ˆë“±ë¡</span></a>
                    <a class="nav-link" href="/cart"><i class="fas fa-shopping-cart"></i><span>ì¥ë°”êµ¬ë‹ˆ</span></a>
                    <a class="nav-link" href="/orders"><i class="fas fa-box"></i><span>ì£¼ë¬¸ë‚´ì—­</span></a>
                    <a class="nav-link" href="/members/password/edit"><i class="fas fa-user-lock"></i><span>ë¹„ë°€ë²ˆí˜¸</span></a>
                    <form th:action="@{/logout}" method="post" style="display:inline; margin:0;">
                        <button class="nav-link border-0 bg-transparent p-0" type="submit">
                            <i class="fas fa-sign-out-alt"></i><span>ë¡œê·¸ì•„ì›ƒ</span>
                        </button>
                    </form>
                </th:block>
                <th:block th:if="${session.loginMember == null}">
                    <a class="nav-link" href="/login"><i class="fas fa-user"></i><span>ë¡œê·¸ì¸</span></a>
                    <a class="nav-link" href="/members/new"><i class="fas fa-user-plus"></i><span>íšŒì›ê°€ì…</span></a>
                </th:block>
            </div>
        </div>

        <div class="header-bottom">
            <div class="search-wrapper">
                <form action="/" method="get">
                    <div class="search-bar">
                        <input type="text" name="searchQuery" th:value="${itemSearchDto.searchQuery}" placeholder="ì°¾ê³  ì‹¶ì€ ìƒí’ˆì„ ì…ë ¥í•˜ì„¸ìš”">
                        <button type="submit" class="btn-search"><i class="fas fa-search"></i></button>
                    </div>
                    <button type="button" class="filter-toggle-btn" onclick="toggleFilter()">
                        <i class="fas fa-sliders-h"></i> ìƒì„¸ ê²€ìƒ‰ (ê°€ê²©/í’ˆì ˆì œì™¸)
                    </button>

                    <div id="filter-section">
						<div class="row g-2 align-items-center">
                        <div class="col-5">
                            <input type="number" name="minPrice" th:value="${itemSearchDto.minPrice}" class="form-control form-control-sm" placeholder="ìµœì†Œê°€ê²©">
                        </div>
                        <div class="col-1 text-center">~</div>
                        <div class="col-5">
                            <input type="number" name="maxPrice" th:value="${itemSearchDto.maxPrice}" class="form-control form-control-sm" placeholder="ìµœëŒ€ê°€ê²©">
                        </div>
                        <div class="col-12 mt-2">
                            <label class="form-check-label small">
                                <input type="checkbox" name="onlyItemsInStock" th:checked="${itemSearchDto.onlyItemsInStock}" class="form-check-input"> í’ˆì ˆ ìƒí’ˆ ì œì™¸
                            </label>
                            <button type="submit" class="btn btn-primary btn-sm float-end">ì ìš©</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</header>

<div class="container">
    <div class="product-grid">
        <a th:each="item : ${items}" th:href="@{/items/{itemId}(itemId=${item.id})}" class="product-card">
            <img th:src="${item.imageUrl}" class="product-img">
            <div class="product-info">
                <div class="product-name" th:text="${item.name}">ìƒí’ˆëª…</div>
                <div class="product-price" th:text="${#numbers.formatInteger(item.price, 0, 'COMMA') + 'ì›'}"></div>
                <div class="product-rating mt-1">
                    <span style="color: #f1c40f;"><i class="fas fa-star"></i></span>
                    <span th:text="${#numbers.formatDecimal(item?.averageRating, 1, 1)}">0.0</span>
                    <span style="color: #999; font-size: 12px;" th:text="'(' + ${item?.reviewCount} + ')'"></span>
                </div>
            </div>
        </a>
    </div>
</div>

<script>
    function toggleFilter() {
        const filter = document.getElementById('filter-section');
        filter.style.display = (filter.style.display === 'block') ? 'none' : 'block';
    }
    
    // í•„í„° ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        const filter = document.getElementById('filter-section');
        const btn = document.querySelector('.filter-toggle-btn');
        if (!filter.contains(event.target) && event.target !== btn && !btn.contains(event.target)) {
            filter.style.display = 'none';
        }
    }
</script>

</body>
</html>